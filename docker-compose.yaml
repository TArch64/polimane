x-common: &common
  env_file: .env
  tty: true
  stdin_open: true

services:
  nginx:
    <<: *common
    image: nginx:1.27-alpine
    volumes:
    - ./ci/dev/nginx/nginx.conf:/etc/nginx/nginx.conf
    - ./ci/dev/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf
    - ./ci/dev/nginx/partials:/etc/nginx/partials
    ports:
    - "80:80"
    depends_on:
    - frontend

  frontend:
    <<: *common
    build:
      context: .
      dockerfile: ./ci/dev/frontend/Dockerfile
    command: bun --bun dev
    volumes:
    - ./frontend:/app
    - ./frontend/node_modules:/app/node_modules
    - bun_cache:/root/.bun/install/cache

volumes:
  bun_cache:
    driver: local