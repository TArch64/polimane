
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>workos: Go Coverage Report</title>
    <style>
        body {
            background: black;
            color: rgb(80, 80, 80);
        }

        body, pre, #legend span {
            font-family: Menlo, monospace;
            font-weight: bold;
        }

        #topbar {
            background: black;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 42px;
            border-bottom: 1px solid rgb(80, 80, 80);
        }

        #content {
            margin-top: 50px;
        }

        #nav, #legend {
            float: left;
            margin-left: 10px;
        }

        #legend {
            margin-top: 12px;
        }

        #nav {
            margin-top: 10px;
        }

        #legend span {
            margin: 0 5px;
        }

        .cov0 {
            color: rgb(192, 0, 0)
        }

        .cov1 {
            color: rgb(128, 128, 128)
        }

        .cov2 {
            color: rgb(116, 140, 131)
        }

        .cov3 {
            color: rgb(104, 152, 134)
        }

        .cov4 {
            color: rgb(92, 164, 137)
        }

        .cov5 {
            color: rgb(80, 176, 140)
        }

        .cov6 {
            color: rgb(68, 188, 143)
        }

        .cov7 {
            color: rgb(56, 200, 146)
        }

        .cov8 {
            color: rgb(44, 212, 149)
        }

        .cov9 {
            color: rgb(32, 224, 152)
        }

        .cov10 {
            color: rgb(20, 236, 155)
        }

    </style>
</head>
<body>
<div id="topbar">
    <div id="nav">
        <select id="files">

            <option value="file0">polimane/backend/services/workos/authenticate_with_access_token.go (100.0%)</option>

            <option value="file1">polimane/backend/services/workos/client.go (0.0%)</option>

            <option value="file2">polimane/backend/services/workos/get_error_code.go (100.0%)</option>

            <option value="file3">polimane/backend/services/workos/mfa.go (100.0%)</option>

            <option value="file4">polimane/backend/services/workos/user_management.go (100.0%)</option>

        </select>
    </div>
    <div id="legend">
        <span>not tracked</span>

        <span class="cov0">no coverage</span>
        <span class="cov1">low coverage</span>
        <span class="cov2">*</span>
        <span class="cov3">*</span>
        <span class="cov4">*</span>
        <span class="cov5">*</span>
        <span class="cov6">*</span>
        <span class="cov7">*</span>
        <span class="cov8">*</span>
        <span class="cov9">*</span>
        <span class="cov10">high coverage</span>

    </div>
</div>
<div id="content">
		
		<pre class="file" id="file0" style="display: none">package workos

import (
        "context"
        "errors"
        "strings"

        "github.com/lestrrat-go/jwx/v3/jwt"
)

var (
        AccessTokenExpired = errors.New("access token expired")
)

type AccessTokenClaims struct {
        UserID    string
        SessionID string
}

func (i *Impl) AuthenticateWithAccessToken(ctx context.Context, tokenStr string) (*AccessTokenClaims, error) <span
                class="cov10"
                title="11"
            >{
        jwksURL, err := i.UserManagement().GetJWKSURL(i.env.WorkOS.ClientID)
        if err != nil </span><span class="cov1" title="1">{
                return nil, err
        }</span>

        <span class="cov8" title="7">keySet, err := i.jwk.Fetch(ctx, jwksURL.String())
        if err != nil </span><span class="cov1" title="1">{
                return nil, err
        }</span>

        <span class="cov7" title="6">token, err := jwt.Parse(
                []byte(tokenStr),
                jwt.WithContext(ctx),
                jwt.WithKeySet(keySet),
                jwt.WithValidate(true),
        )

        if err != nil </span><span class="cov6" title="4">{
                if strings.Contains(err.Error(), "token is expired") </span><span class="cov1" title="1">{
                        return nil, AccessTokenExpired
                }</span>

                <span class="cov5" title="3">return nil, err</span>
        }

        <span class="cov3" title="2">userID, _ := token.Subject()

        var sessionID string
        if err = token.Get("sid", &amp;sessionID); err != nil </span><span class="cov1" title="1">{
                return nil, err
        }</span>

        <span class="cov1" title="1">return &amp;AccessTokenClaims{
                UserID:    userID,
                SessionID: sessionID,
        }, nil</span>
}
</pre>

    <pre class="file" id="file1" style="display: none">package workos

import (
        "context"

        "github.com/workos/workos-go/v4/pkg/mfa"
        "github.com/workos/workos-go/v4/pkg/usermanagement"
        "go.uber.org/fx"

        "polimane/backend/env"
        "polimane/backend/services/jwk"
)

type ClientOptions struct {
        fx.In
        Env *env.Environment
        JWK jwk.Client
}

type Client interface {
        UserManagement() UserManagement
        MFA() MFA
        AuthenticateWithAccessToken(ctx context.Context, tokenStr string) (*AccessTokenClaims, error)
}

type Impl struct {
        userManagement UserManagement
        mfa            MFA
        env            *env.Environment
        jwk            jwk.Client
}

func Provider(options ClientOptions) Client <span class="cov0" title="0">{
        usermanagement.SetAPIKey(options.Env.WorkOS.ApiKey)
        mfa.SetAPIKey(options.Env.WorkOS.ApiKey)

        return &amp;Impl{
                userManagement: usermanagement.DefaultClient,
                mfa:            mfa.DefaultClient,
                env:            options.Env,
                jwk:            options.JWK,
        }
}</span>
</pre>

    <pre class="file" id="file2" style="display: none">package workos

import (
        "encoding/json"

        "github.com/workos/workos-go/v4/pkg/workos_errors"
)

const (
        CodeEmailVerificationCodeExpired = "email_verification_code_expired"
        CodeUnknownError                 = "unknown"
)

type httpErrorRawBody struct {
        Code string `json:"code"`
}

func GetErrorCode(httpErr workos_errors.HTTPError) string <span class="cov10" title="13">{
        var rawBody httpErrorRawBody
        if err := json.Unmarshal([]byte(httpErr.RawBody), &amp;rawBody); err != nil </span><span class="cov7" title="6">{
                return CodeUnknownError
        }</span>
        <span class="cov7" title="7">if rawBody.Code == "" </span><span class="cov5" title="4">{
                return CodeUnknownError
        }</span>
        <span class="cov4" title="3">return rawBody.Code</span>
}
</pre>

    <pre class="file" id="file3" style="display: none">package workos

import (
        "context"

        "github.com/workos/workos-go/v4/pkg/mfa"
)

type MFA interface {
        DeleteFactor(ctx context.Context, opts mfa.DeleteFactorOpts) error
        VerifyChallenge(ctx context.Context, opts mfa.VerifyChallengeOpts) (mfa.VerifyChallengeResponse, error)
        GetFactor(ctx context.Context, opts mfa.GetFactorOpts) (mfa.Factor, error)
}

func (i *Impl) MFA() MFA <span class="cov10" title="2">{
        return i.mfa
}</span>
</pre>

    <pre class="file" id="file4" style="display: none">package workos

import (
        "context"
        "net/url"

        "github.com/workos/workos-go/v4/pkg/usermanagement"
)

type UserManagement interface {
        GetAuthorizationURL(opts usermanagement.GetAuthorizationURLOpts) (*url.URL, error)
        AuthenticateWithCode(ctx context.Context, opts usermanagement.AuthenticateWithCodeOpts) (usermanagement.AuthenticateResponse, error)
        UpdateUser(ctx context.Context, opts usermanagement.UpdateUserOpts) (usermanagement.User, error)
        RevokeSession(ctx context.Context, opts usermanagement.RevokeSessionOpts) error
        AuthenticateWithRefreshToken(ctx context.Context, opts usermanagement.AuthenticateWithRefreshTokenOpts) (usermanagement.RefreshAuthenticationResponse, error)
        GetUser(ctx context.Context, opts usermanagement.GetUserOpts) (usermanagement.User, error)
        EnrollAuthFactor(ctx context.Context, opts usermanagement.EnrollAuthFactorOpts) (usermanagement.EnrollAuthFactorResponse, error)
        ListAuthFactors(ctx context.Context, opts usermanagement.ListAuthFactorsOpts) (usermanagement.ListAuthFactorsResponse, error)
        VerifyEmail(ctx context.Context, opts usermanagement.VerifyEmailOpts) (usermanagement.UserResponse, error)
        SendVerificationEmail(ctx context.Context, opts usermanagement.SendVerificationEmailOpts) (usermanagement.UserResponse, error)
        CreatePasswordReset(ctx context.Context, opts usermanagement.CreatePasswordResetOpts) (usermanagement.PasswordReset, error)
        GetJWKSURL(clientID string) (*url.URL, error)
}

func (i *Impl) UserManagement() UserManagement <span class="cov10" title="13">{
        return i.userManagement
}</span>
</pre>

</div>
</body>
<script>
    (function () {
        var files = document.getElementById('files');
        var visible;
        files.addEventListener('change', onChange, false);

        function select(part) {
            if (visible)
                visible.style.display = 'none';
            visible = document.getElementById(part);
            if (!visible)
                return;
            files.value = part;
            visible.style.display = 'block';
            location.hash = part;
        }

        function onChange() {
            select(files.value);
            window.scrollTo(0, 0);
        }

        if (location.hash != '') {
            select(location.hash.substr(1));
        }
        if (!visible) {
            select('file0');
        }
    })();
</script>
</html>
